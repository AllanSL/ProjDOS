{% extends 'base.html' %}
{% block title %}
  Cadastrar Produto
{% endblock %}

{% block content %}
  <div class="container">
    <h2 class="mb-4">Cadastrar Novo Produto</h2>
    <form method="POST" action="{% url 'criar_produto' %}">
      {% csrf_token %}
      <div class="mb-3">
        <label for="nome" class="form-label">Nome</label>
        <input type="text" class="form-control" id="nome" name="nome" required />
      </div>
      <div class="mb-3">
        <label for="descricao" class="form-label">Descrição</label>
        <textarea class="form-control" id="descricao" name="descricao" rows="3" required></textarea>
      </div>
      <div class="mb-3">
        <label for="marca" class="form-label">Marca</label>
        <input type="text" class="form-control" id="marca" name="marca" maxlength="16" required />
      </div>
      <div class="mb-3">
        <label for="preco" class="form-label">Preço</label>
        <input type="text" class="form-control" id="preco" name="preco" required oninput="formatarMoeda(this)" min="0" />
      </div>
      <div class="mb-3">
        <label for="saldo_estoque" class="form-label">Quantidade em estoque</label>
        <input type="number" class="form-control" id="saldo_estoque" name="saldo_estoque" required min="0" oninput="verificarQuantidade(this)" />
      </div>
      <button type="submit" class="btn btn-success">Cadastrar</button>
      <a href="{% url 'listar_produtos' %}" class="btn btn-secondary">Cancelar</a>
    </form>
  </div>
{% endblock %}

{% block extra_scripts %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const precoCampo = document.getElementById('preco')
      const saldoEstoqueCampo = document.getElementById('saldo_estoque')
    
      // Formata o valor inicial do campo de preço
      if (precoCampo && !precoCampo.value) {
        precoCampo.value = 'R$0,00'
      }
    
      // Define o valor inicial do campo de quantidade em estoque
      if (saldoEstoqueCampo && !saldoEstoqueCampo.value) {
        saldoEstoqueCampo.value = 0
      }
    })
    
    function formatarMoeda(campo) {
      let valor = campo.value
    
      // Remove qualquer caractere que não seja número
      valor = valor.replace(/\D/g, '')
    
      // Se o campo estiver vazio, assume o valor 0
      if (!valor) {
        campo.value = 'R$0,00'
        return
      }
    
      // Converte para número e formata como moeda
      valor = (parseFloat(valor) / 100).toLocaleString('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      })
    
      // Atualiza o campo com o valor formatado
      campo.value = valor
    }
    
    function verificarQuantidade(campo) {
      // Se o campo estiver vazio, assume o valor 0
      if (!campo.value) {
        campo.value = 0
      }
    }
  </script>
{% endblock %}
